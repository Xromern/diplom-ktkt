
{% extends 'base-journal.html.twig' %}

{% block title %}Групи{% endblock %}

{% block body %}


    <div class="container-table-subject-journal">

        <table class="table-subject-journal table ver" >
            {{ include('journal/journal_subject/head-table.html.twig',{'subject':subject}) }}

        </table>
    </div>


    <div class="container-subject-block">
        <div class="button button-show-modal-update-subject"> Редагувати предмет.</div>
        <div class="button button-delete-subject"> Видалити предмет.</div>
    </div>

    <div id="myModal" class="modal modal-update-subject">
        <!-- Modal content -->
        <div class="modal-content">
            <span class="modal-close">✘</span>
            <div class="modal-container-journal-update-subject">
                <input type="text" class="input-update-subject" placeholder="Предмет" required="required"/>
                <select class="select-teacher">
                </select>
                <div class="button button-update-subject">Зберегти</div>
            </div>
            <div class="container-table-students-subject">
                @include('MainSite.preloader')
                <div class="field_block_2 student_select">
                    <table class="student_ student_yes">
                    </table>
                    <table class="student_ student_no">
                    </table>
                </div>
            </div>
        </div>

    </div>

    <div id="modal-date" class="modal modal-date-subject">
        <!-- Modal content -->
        <div class="modal-content">
            <span class="modal-close">✘</span>

            <div class="modal-container-date-subject">
                <div class="row-date-modal">
                <input type="date" class="date-subject-modal" >
                <select class="select-type-mark"></select>
                    <input type="color" class="color-mark" style="padding: 0;background-color: #FFFFFF; border: #1e5ad1;" >
                </div>
                <div class="subject-modal-block-attestation">
                <textarea class="textarea-subject-modal"></textarea>

                <div class="button button-update-subject-date">Зберегти</div>
            </div>

        </div>

    </div>
    <script>
        //showSubjectJournal()

        function showSubjectJournal() {
            $.ajax({
                type: 'post',
                url: "{{ path('showTableSubject') }}",
                data: ({

                    "subject_id": '{{ subject.getId }}'
                }),
                error: function () {
                    note({
                        content: "Сталася помилка, перезавантажте сторінку.",
                        type: "error",
                        time: 15
                    });
                },
                success: function (result) {
                    $('.table-subject-journal').html(result)
                }
            });
        }

        $('html').on('change', '.table-subject-select',function () {
            updateMark($(this).val(), $(this).attr('data-id-mark'));
        })

        function updateMark(mark, mark_id,student_id) {

            $.ajax({
                type: 'POST',
                url: "{{ path('markUpdate') }}",
                data: ({
                    'mark': mark,
                    'mark_id': mark_id,

                }),
                error: function () {
                    note({
                        content: "Сталася помилка, перезавантажте сторінку.",
                        type: "error",
                        time: 15
                    });
                },
                success: function (result) {

                    showSubjectJournal();
                }
            });
        }

        $('html').on('click', '.button-update-subject-date', function () {

            updateDate();

            showSubjectJournal();

        });

        function updateDate() {

            let date_id = $('.modal-update-subject').attr('data-date-id');
            let date = $('.date-subject-modal').val();
            let description = $('.textarea-subject-modal').val();
            let typeMark = $('.select-type-mark').val();
            let color = $('.color-mark').val();
            console.log(color);
            $.ajax({
                type: 'POST',
               url: '{{ path('dateMarkUpdate') }}',
                data: ({
                    "date_id": date_id,
                    "date":date,
                    "description":description,
                    "type_mark_id":typeMark,
                    "color":color
                }),
                error: function () {
                    note({
                        content: "Сталася помилка, перезавантажте сторінку.",
                        type: "error",
                        time: 15
                    });
                },
                success: function (result) {
                    //console.log(result)

                }
            });
        }

        function getDate(date_id) {

            $.ajax({
                type: 'POST',
                url: '/journal/getDate',
                data: ({
                    "date_id": date_id
                }),
                error: function () {
                    note({
                        content: "Сталася помилка, перезавантажте сторінку.",
                        type: "error",
                        time: 15
                    });
                },
                success: function (result) {
                    $('.date-subject-modal').val(result['date']);
                    $('.textarea-subject-modal').val(result['description']);
                    $('.checkbox-subject-modal').prop('checked', result['attestation']);
                }
            });
        }

        function getTypeMark(){
            $.ajax({
                type: 'post',
                url: "{{ path('journal_type_mark') }}",
                error: function () {
                    note({
                        content: "Сталася помилка, перезавантажте сторінку.",
                        type: "error",
                        time: 15
                    });
                },
                success: function (result) {
                    console.log(result)
                    $('.select-type-mark').html(result)
                }
            });
        }

        let modal = document.getElementById('myModal');

        let span = document.getElementsByClassName("modal-close")[0];

        let modal_content = document.getElementsByClassName("modal-close")[0];
        //если кликаю на крестик, добавлюя id коммента в модальное окно для редактирование комменатрия
        $('html').on('click', '.button-show-modal-update-subject', function () {
            showSubjectTeacherList()
            getSubjectStudent()
            getSubjectName();
            getTypeMark();
            modal.style.display = "block";

        });

        span.onclick = function () {
            $('.student_select').html("");
            modal.style.display = "none";
        }

        window.onclick = function (event) {
            if (event.target == modal) {
                $('.student_select').html("");

                modal.style.display = "none";
            }
        }


        let modal_date = document.getElementById('modal-date');

        $('html').on('click', '.button-update-subject-date', function () {

            var date_id = $('.modal-update-subject').attr('data-date-id');
            var date = $('.date-subject-modal').val();
            var description = $('.textarea-subject-modal').val();
            var attestation = $('.checkbox-subject-modal').is(':checked');
            attestation = attestation?1:0;
            updateDate(date_id,date,description,attestation);

            showSubjectJournal();

        });


        //если кликаю на крестик, добавлюя id коммента в модальное окно для редактирование комменатрия
        $('html').on('click', '.journal-table-date', function () {
            let date_id =  $(this).attr('data-date-id');
            $('.modal-update-subject').attr('data-date-id',date_id);
            //getDate(date_id);
            modal_date.style.display = "block";
            getTypeMark();


        });

        span.onclick = function () {
            $('.date-subject-modal').val('');
            $('.textarea-subject-modal').val('');
            $('.checkbox-subject-modal').val('')
            modal_date.style.display = "none";
        }

        window.onclick = function (event) {
            if (event.target == modal_date) {


                modal_date.style.display = "none";
            }
        }

        $('html').on('mouseover', '.column', function() {

            let table2 = $(this).parent().parent();
            let column = $(this).data('column') + "";
            $(table2).find("." + column).addClass('hov-column');

        });
        $('html').on('mouseout', '.column', function() {

            let table2 = $(this).parent().parent();
            let column = $(this).data('column') + "";
            $(table2).find("." + column).removeClass('hov-column');

        });
    </script>
{% endblock %}